\documentclass[11pt]{report}
\usepackage[utf8]{inputenc}
\usepackage[myheadings]{fullpage}
\DeclareUnicodeCharacter{0301}{\hspace{-1ex}\'{ }}

\usepackage{silence}

% Package for headers 
\usepackage{fancyhdr}
\usepackage{lastpage}

% For figures and stuff
\usepackage{graphicx, wrapfig, subcaption, setspace, booktabs}
\usepackage[T1]{fontenc}

% Change for different font sizes and families
\usepackage[font=small, labelfont=bf]{caption}
\usepackage{fourier}
\usepackage[protrusion=true, expansion=true]{microtype}

% Maths
\usepackage{amsmath,amssymb}
\usepackage{float}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}

% Code
\usepackage{minted}
\usepackage{adjustbox}
\usepackage[linesnumbered,ruled,vlined]{algorithm2e}
\SetKwProg{While}{while}{}{}
\SetKwProg{For}{for}{}{}
\SetKwProg{Function}{function}{}{}

% Bibliography
\usepackage{biblatex} 
\addbibresource{../references.bib}

%Glossary
\usepackage[acronym]{glossaries}
\makeglossaries
\input{../glossary}

%% Language and font encodings
\usepackage[english]{babel}
\usepackage{csquotes}
\usepackage{indentfirst}

%Tabular
\usepackage{tabularx}
\usepackage{multirow}
\usepackage[table]{xcolor}
\usepackage{xcolor}
\usepackage{enumitem}
\usepackage{arydshln}

%Function draw

\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usepackage{tikz}
\usepackage{tikz-uml}
\usepackage{amsmath}
\usepackage{pgfmath}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning}
\usetikzlibrary{fit, backgrounds, calc}
\usepackage{dirtree}

\usepackage{afterpage}

% Show mini ToCs automatically at the beginning of each chapter
\usepackage{minitoc}
\setcounter{tocdepth}{0}        % Only show chapters in the main ToC
\setcounter{minitocdepth}{2}    % Show sections and subsections in mini ToCs
\dominitoc                      % Enable mini ToCs
\WarningFilter{minitoc(hints)}{W0024}

\definecolor{terminalbg}{RGB}{0,0,0}
\definecolor{terminalfg}{RGB}{255, 255, 255} 

\newminted[console]{bash}{
  bgcolor=terminalbg,
  fontfamily=tt,
  fontsize=\small,
  linenos=false,
  framesep=100mm,
  rulecolor=\color{white},
  baselinestretch=1,
  breaklines=true
}


\newcommand\blankpage{%
    \null
    \thispagestyle{empty}%
    \addtocounter{page}{-1}%
    \newpage}

\newcommand{\HRule}[1]{\rule{\linewidth}{#1}}
\onehalfspacing

%% Sets page size and margins
\usepackage[a4paper,top=2cm,bottom=1.5cm,left=2cm,right=2cm,marginparwidth=1.5cm]{geometry}
% Command to draw a horizontal line
\newcommand{\separator}{%
    \begin{center}
      {\Large$\ast$~$\ast$~$\ast$}
    \end{center}
}


\setlength{\parskip}{10pt}
\setlength{\parindent}{1cm}

\pagestyle{fancy}
\fancyhf{}

% Header and footer information
\setlength\headheight{15pt}
\author{Mathys VINATIER}
%\fancyhead[L]{IPSA} 
\fancyhead[R]{Mathys VINATIER}
\fancyfoot[R]{\thepage}
 \setlength {\marginparwidth }{2cm}
\begin{document}


\date{}

\title{ 
		\HRule{2pt} \\
		\LARGE \textbf{ Report on PPO agent for Finance } 
		\HRule{2pt} \\ [0.5cm]
		\normalsize \today \vspace*{5\baselineskip}\\
		Mathys VINATIER  - \href{https://github.com/MathysVinatier/PPO_finance/blob/main/}{GitHub Project page}\\
		Supervisor:      \\
		  Pr Kim Tae-Wan
      }

\maketitle

\newpage
\blankpage
\newpage

\tableofcontents
\blankpage

\newpage
\blankpage
\newpage

\setcounter{chapter}{20}
\chapter{Week 21}
\minitoc

\newpage
\blankpage

\newpage

\section{The PPO Agent Training}

\indent This week, we built and trained the model based on the previous recommendations. Several experiments were conducted to fine-tune and identify the optimal configuration of the PPO agent. Different parameter settings were tested across multiple trials, which will be discussed in this report.

\noindent As an initial step, we performed small adjustments to intentionally create an overfitting model. This helps verify that the agent can effectively learn from historical data before introducing regularization or exploration strategies. For this purpose, some parameters were fixed as follows:

\begin{itemize}
    \item Discount factor $\gamma = 0.99$
    \item Learning rate $\alpha = 3 \times 10^{-4}$
    \item Generalized Advantage Estimation parameter $\lambda = 0.95$
    \item Policy clipping coefficient $\epsilon = 0.2$
\end{itemize}

\noindent These parameters play a key role in shaping the agent's learning dynamics. The discount factor $\gamma$ determines how strongly future rewards influence current decisions—values close to 1 encourage long-term planning, while smaller values emphasize immediate rewards. The learning rate $\alpha$ controls the step size of parameter updates ; higher values speed up learning but risk instability, whereas lower values make learning slower and more stable. The GAE parameter $\lambda$ balances bias and variance in advantage estimation : larger $\lambda$ values produce smoother, more consistent updates but can increase variance. Finally, the clipping coefficient $\epsilon$ stabilizes policy updates by preventing the new policy from deviating too far from the old one, ensuring more reliable convergence during training.


\subsection{First training analysis}


\indent For the initial training phase, we selected a set of baseline parameters to establish a reference point for the PPO agent's learning behavior. The chosen configuration is summarized below :

\begin{itemize}
    \item Episodes : $300$
    \item Epochs per update : $10$
    \item Batch size : $128$
\end{itemize}

\noindent The goal of this setup was to allow the agent to experience a relatively large number of episodes, providing diverse trajectories for training, while keeping the number of epochs moderate to prevent overfitting on limited data. This configuration encourages the critic network to refine its value estimation across a broader range of states, which in turn supports more stable policy updates by the actor. 

\noindent The following section presents and discusses the main results obtained from this first round of training :

\newpage

\vfill
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_001/train.png}
    \caption{Training 1 - Training of trial 1}
\end{figure}
\vspace{1cm}
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_001/test.png}
    \caption{Training 1 - Test of trial 1}
\end{figure}

\noindent We can see that the training did not learn well since we have only few trades made, also the test has made very poor actions. We can consider that this first trial is really underfiting.
\vfill

\newpage

\vfill
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_002/train.png}
    \caption{Training 1 - Training of trial 2}
\end{figure}
\vspace{1cm}
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_002/test.png}
    \caption{Training 1 - Test of trial 2}
\end{figure}
\noindent As previously, we can see that the model is clearly underfiting since it has made only one trade  during testing and training which is representing an underfitting model.
\vfill

\newpage

\vfill
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_003/train.png}
    \caption{Training 1 - Training of trial 3}
\end{figure}
\vspace{1cm}
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_003/test.png}
    \caption{Training 1 - Test of trial 3}
\end{figure}
\noindent The model did not take any trade neither on training or testing. We cannot evaluate this model.
\vfill

\newpage

\vfill
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_004/train.png}
    \caption{Training 1 - Training of trial 4}
\end{figure}
\vspace{1cm}
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_004/test.png}
    \caption{Training 1 - Test of trial 4}
\end{figure}
\noindent This model clearly learnt in training. However in testing the model is overfitting since it is not making wise trade.
\vfill

\newpage

\vfill
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_005/train.png}
    \caption{Training 1 - Training of trial 5}
\end{figure}
\vspace{1cm}
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_1/trial_005/test.png}
    \caption{Training 1 - Test of trial 5}
\end{figure}
\noindent Like the trial 3, we cannot analyse this model since it has made no trade.\par

\begin{figure}[H]
    \centering
    \scalebox{0.9}{
    \begin{tabular}{c|cccccc}
        \textbf{Trial} & \textbf{Training Profit} & \textbf{Testing Profit} & \textbf{Annual Return} & \textbf{Annual Volatility} & \textbf{Sharpe Ratio} & \textbf{Max Drawdown} \\ \hline
        \textit{1} & $-822.5$ & $74$ & $0.17\mathdollar / \text{year}$ & $0.17$ & $-0.07$ & $-0.20$ \\ \hline
        \textit{2} &   $4.5$  &  $3$ & $0.01\mathdollar / \text{year}$ & $0.01$ &  $0.71$ & $0.00$ \\ \hline
        \textit{3} &   $0$    &  $0$ & $0.00\mathdollar / \text{year}$ & $0.00$ &    $0$  & $0.00$ \\ \hline
        \textit{4} & $3930.5$ &  $0$ & $0.13\mathdollar / \text{year}$ & $0.13$ &  $0.10$ & $-0.11$ \\ \hline
        \textit{5} &   $0$    &  $0$ & $0.00\mathdollar / \text{year}$ & $0.00$ &    $0$  & $0.00$ \\ \hline
    \end{tabular}
    }
    \caption{Summary of the trials performances}
\end{figure}
    
\noindent The results from these trials indicate clear signs of underfitting. Most configurations exhibited weak overall performance, and the single trial that achieved relatively good results during training failed to generalize well in the testing phase, suggesting that the model did not effectively capture the underlying dynamics of the environment.

\vfill

\newpage

\subsection{Second training analysis}

\indent We would like to get a less overfitting model, for that we will work with more epoch and less episode to get a better trained thru the episodes, we will use the following training parameters :

\begin{itemize}
    \item Episodes : $200$
    \item Epochs per update : $50$
    \item Batch size : $128$
\end{itemize}

\noindent For this training, we are going to get a better look at each episode to better analyse the learning behavior of our model :


\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_2/trial_001/epoch_analysis.png}
    \caption{Training 2 - Training thru the epochs}
\end{figure}

\noindent As observed, the model demonstrates progressively wiser trading behavior across episodes, suggesting that it successfully captures and adapts to the underlying market dynamics during training. The learning curve reveals two distinct phases: initially, the agent learns to execute more strategic and selective trades, improving the efficiency of its decisions; subsequently, the model stabilizes the number of trades while gradually increasing overall profit.

\newpage

\noindent Compared to the previous configuration, this version exhibits stronger learning performance, primarily due to the increased number of training epochs. However, the risk of overfitting remains and further evaluation on unseen data is necessary to assess the model's generalization capability and ensure robust performance in different market conditions :

\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_2/trial_001/train.png}
    \caption{Training 2 - Training of trial 1}
\end{figure}
\vspace{1cm}
\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_2/trial_001/test.png}
    \caption{Training 2 - Test of trial 1}
\end{figure}

\noindent As we can see, the model has been overfitting. However since it is a stochastic model, we should compute many time our model to determine his usual behavior. Adding other features has input from other related market could be also a solution to our problem (VVIX / S\&P500).

%\newpage

%\appendix


%\newpage

%Références
%\printbibliography

\newpage

\setcounter{chapter}{22}
\chapter{Week 23}
\minitoc

\newpage
\blankpage

\newpage

\section{The PPO Training API}

\indent In this section, we present the key components of the API we developed to automate the instantiation of PPO training for different agents. This API is crucial for fine-tuning agents and understanding the structure of the reward function.

\begin{wrapfigure}{r}{0.4\textwidth}
    \dirtree{%
    .1 /PPO\_training\_monitor/.
        .2 \textbf{logs}/.
            .3 training\_task\_0.log.
            .3 training\_task\_1.log.
            .3 \ldots.
        .2 \textbf{static}/.
            .3 script.js.
            .3 style.css.
        .2 \textbf{templates}/.
            .3 dashboard.html.
        .2 \textbf{utils}/.
            .3 \_\_init\_\_.py.
            .3 config.py.
            .3 getter.py.
            .3 info\_system.py.
            .3 listing.py.
            .3 plot.py.
            .3 task\_manager.py.
        .2 \textbf{main.py}.
    }
    \caption{API Directory Architecture}
    \vspace{-2cm}
\end{wrapfigure}
\noindent The API consists of both frontend and backend components. The frontend, built using HTML and CSS, provides a dynamic dashboard to visualize the training process in real time. The \texttt{logs} directory contains the raw output of the training scripts executed via the command line, which is essential for debugging and monitoring the progress of each training episode.

\noindent The \texttt{static} and \texttt{templates} directories support the frontend interface, managing visual elements and the real-time display of training metrics. These components are critical for handling errors gracefully without interrupting training or saving models, which are the core pieces of information.

\noindent Finally, the \texttt{utils} directory contains helper functions that complement \texttt{main.py}, the central script responsible for running the FastAPI application with Uvicorn. This setup enables a dynamic connection between the frontend and the backend databases, where all training data and model information are stored securely and efficiently.\par

\vspace{1cm}

\begin{wrapfigure}{r}{0.4\textwidth}
    \includegraphics[width=\linewidth]{../img/training_api/api_seq_diagram.png.drawio.png}
    \caption{API - Sequence Diagram}
\end{wrapfigure}

\noindent The Dashboard of the front end has 3 main parts :

\begin{itemize}
    \item \textbf{Training Monitor} : Show a graph of the overview of each episode (Loss / number of trade / reward) with a tabular that display the detailed information of each databases of the selected task
    \item \textbf{Testing Monitor} : Display 3 graphics : The analysis report that is giving the results of each saved models on both the training and the testing dataset. Two plots that gievs for the training and testing dataset the detailed of the chosen action of the latest saved model.
    \item \textbf{System Stats} : Provide the computer statistics, the current active tasks, the launcher of training and a logs that is giving live information about the selected task.
\end{itemize}

\newpage

\hfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_api/dashboard_training.png}
    \caption{Dashboard - Training Monitor}
\end{figure}

\hfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_api/dashboard_testing.png}
    \caption{Dashboard - Testing Monitor}
\end{figure}

\hfill

\newpage

\section{Training without borker fees}

\subsection{Task 0 (no broker) - \textrm{batch\_size} = 128, epochs = 50, episode = 200}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_0/data_training/plot/trial_001/train.png}
    \caption{Task 0 - Training plot (no broker)}
\end{figure}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_0/data_training/plot/trial_001/test.png}
    \caption{Task 0 - Testing plot (no broker)}
\end{figure}

\vfill

\newpage

\subsection{Task 1 (no broker) - \textrm{batch\_size} = 128, epochs = 10, episode = 100}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_1/data_training/plot/trial_001/train.png}
    \caption{Task 1 - Training plot (no broker)}
\end{figure}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_1/data_training/plot/trial_001/test.png}
    \caption{Task 1 - Testing plot (no broker)}
\end{figure}

\vfill

\newpage

\subsection{Task 2 (no broker) - \textrm{batch\_size} = 128, epochs = 100, episode = 100}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_2/data_training/plot/trial_001/train.png}
    \caption{Task 2 - Training plot (no broker)}
\end{figure}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_2/data_training/plot/trial_001/test.png}
    \caption{Task 2 - Testing plot (no broker)}
\end{figure}

\vfill

\newpage

\subsection{Task 3 (no broker) - \textrm{batch\_size} = 64, epochs = 112, episode = 10}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_3/data_training/plot/trial_001/train.png}
    \caption{Task 3 - Training plot (no broker)}
\end{figure}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_3/data_training/plot/trial_001/test.png}
    \caption{Task 3 - Testing plot (no broker)}
\end{figure}

\vfill

\newpage

\subsection{Task 4 (no broker) - \textrm{batch\_size} = 32, epochs = 100, episode = 100}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_4/data_training/plot/trial_001/train.png}
    \caption{Task 4 - Training plot (no broker)}
\end{figure}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_4/data_training/plot/trial_001/test.png}
    \caption{Task 4 - Testing plot (no broker)}
\end{figure}

\vfill

\newpage

\subsection{Task 5 (no broker) - \textrm{batch\_size} = 64, epochs = 100, episode = 100}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_5/data_training/plot/trial_001/train.png}
    \caption{Task 5 - Training plot (no broker)}
\end{figure}

\vfill

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_5/data_training/plot/trial_001/test.png}
    \caption{Task 5 - Testing plot (no broker)}
\end{figure}

\vfill

\newpage

\subsection{Conslusion on tasks (no broker)}

\indent We can see than half of the models did not took a trade, it seems that with few episode or epochs ($\sim 10$), the model is making to trades, which make sense since it has not learn enough. Overall, the models seems to understand the dynamic of the market during trading and the best model on test has been for the task 4 :

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_no_broker/task_4/data_training/plot/trial_001/test.png}
    \caption{recap of Task 4 - Testing plot (no broker)}
\end{figure}

\begin{figure}[H]
    \centering
    \begin{tabular}{|c|c|c|c|}
        \textbf{annual return} & \textbf{avg profit} & \textbf{annual vol.} & \textbf{max drawdown} \\ \hline
        $0.082$ & $0.0003$ & $0.11$ & $6\%$ \\
    \end{tabular}
    \caption{Report Analysis of task 4}
\end{figure}

\noindent This model has a good drawdown and seems reliable and able to understand the market dynamic, so far the best model has been :

\vspace{1cm}

\begin{figure}[H]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|}
        \textbf{Episodes} & \textbf{Epochs} & \textbf{Tick} & \textbf{Batch Size} & \textbf{Learning Rate} & \textbf{Final Profit on test}\\ \hline
        $100$ & $100$ & Daily & $32$ & $0.0003$ & $17\%$\\
    \end{tabular}
    \caption{Detailed of the best trial}
\end{figure}

\vspace{1cm}

\noindent Let's remember that there is no borker's fee during these tests. The next part is dedicated to the broker's fee experiment. That way we can see if our model and training are adapted to the real world market.


\newpage

\section{Training with borker fees}

\subsection{Task 0 - \textrm{batch\_size} = 32, epochs = 50}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_0/data_training/plot/trial_001/analysis.png}
    \caption{Task 0 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_0/data_training/plot/trial_001/train.png}
    \caption{Task 0 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_0/data_training/plot/trial_001/test.png}
    \caption{Task 0 - Testing plot}
\end{figure}

\newpage

\subsection{Task 1 - \textrm{batch\_size} = 32, epochs = 100}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_1/data_training/plot/trial_001/analysis.png}
    \caption{Task 1 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_1/data_training/plot/trial_001/train.png}
    \caption{Task 1 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_1/data_training/plot/trial_001/test.png}
    \caption{Task 1 - Testing plot}
\end{figure}

\newpage

\subsection{Task 2 - \textrm{batch\_size} = 64, epochs = 50}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_2/data_training/plot/trial_001/analysis.png}
    \caption{Task 2 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_2/data_training/plot/trial_001/train.png}
    \caption{Task 2 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_2/data_training/plot/trial_001/test.png}
    \caption{Task 2 - Testing plot}
\end{figure}

\newpage

\subsection{Task 3 - \textrm{batch\_size} = 64, epochs = 100}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_3/data_training/plot/trial_001/analysis.png}
    \caption{Task 3 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_3/data_training/plot/trial_001/train.png}
    \caption{Task 3 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_3/data_training/plot/trial_001/test.png}
    \caption{Task 3 - Testing plot}
\end{figure}

\newpage

\subsection{Task 4 - \textrm{batch\_size} = 128, epochs = 50}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_4/data_training/plot/trial_001/analysis.png}
    \caption{Task 4 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_4/data_training/plot/trial_001/train.png}
    \caption{Task 4 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_4/data_training/plot/trial_001/test.png}
    \caption{Task 4 - Testing plot}
\end{figure}

\newpage

\subsection{Task 5 - \textrm{batch\_size} = 128, epochs = 100}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_5/data_training/plot/trial_001/analysis.png}
    \caption{Task 5 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_5/data_training/plot/trial_001/train.png}
    \caption{Task 5 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_5/data_training/plot/trial_001/test.png}
    \caption{Task 5 - Testing plot}
\end{figure}

\newpage

\subsection{Task 6 - \textrm{batch\_size} = 256, epochs = 50}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_6/data_training/plot/trial_001/analysis.png}
    \caption{Task 6 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_6/data_training/plot/trial_001/train.png}
    \caption{Task 6 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_6/data_training/plot/trial_001/test.png}
    \caption{Task 6 - Testing plot}
\end{figure}

\newpage

\subsection{Task 7 - \textrm{batch\_size} = 256, epochs = 100}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_7/data_training/plot/trial_001/analysis.png}
    \caption{Task 7 - Analysis plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_7/data_training/plot/trial_001/train.png}
    \caption{Task 7 - Training plot}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{/home/mathys/Documents/PPO_finance/multitask_PPO/trials_epochs/task_7/data_training/plot/trial_001/test.png}
    \caption{Task 7 - Testing plot}
\end{figure}

\subsection{Conclusion on tasks}

\indent As we saw, the results of this first week of training had been poor. The model has a real issue handling the broker's fees, except for one task. The task number 6 had poor perforance during the training, however, the episode 19 showed a good final results by well handling a peak at step 400 :

\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_api/task_6_episode_19_train.png}
    \caption{Task 6 - Episode 19 Train}
\end{figure}

\begin{figure}[H]
    \includegraphics[width=\linewidth]{../img/training_api/task_6_episode_19_test.png}
    \caption{Task 6 - Episode 19 Test}
\end{figure}

\noindent As we can see, the test dataset has good performance but is making only one trade during two years. Also the training is terrible. We think that there is an issue with the reward function since it is always bad, further investigation needs to be done. However the conclusion on that first week training is that the best results has been on these parameters :

\vfill

\begin{figure}[H]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|}
        \textbf{Episodes} & \textbf{Epochs} & \textbf{Tick} & \textbf{Batch Size} & \textbf{Learning Rate} & \textbf{Final Profit on test}\\ \hline
        $19$ & $50$ & Daily & $256$ & $0.0003$ & $17\%$\\
    \end{tabular}
    \caption{Detailed of the best trial}
\end{figure}

\vfill

\section{Workflow - What's left ?}

\indent So far our main core of the workflow has been built, trhough the API, it is now possible to train any robot thanks to a test bench. However, some tasks needs to be explored :

\begin{itemize}
    \item Changing the dataset tick to a 5-minutes baselineski
    \item Add the S\&P500 market and VVIX index
    \item It has been suggested to use the following signal :
        \begin{enumerate}[label=(\alph*)]
            \item
            \begin{align*}
                a_{\text{signal}} &= VVIX_{\text{index}} \times VIX_{\text{index}} \times a_{\text{signal}} \\
                &= \frac{VVIX_{\text{index}}}{VIX_{\text{index}}} \times a_{\text{signal}} \\
                &= VIX_{\text{index}} \times VVIX_{\text{index}} \, (\text{ratio})
            \end{align*}

            \item 
            \begin{align*}
                b_{\text{signal}} &= \ln\left(VVIX_{\text{index}}\right) - \ln\left(VIX_{\text{index}}\right)
            \end{align*}
        \end{enumerate}
    \item Fine-tune another time with the new training features
\end{itemize}

\newpage


%Glossaire
\printacronyms

% \newpage

% \printglossary

% %Annexes
% \section{Annexes}
% \input{annexe.tex}

\end{document}
